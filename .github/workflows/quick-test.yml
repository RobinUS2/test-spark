name: Quick Test

on:
  workflow_dispatch:  # Manual trigger only
  
jobs:
  quick-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Build and run PySpark application
      run: |
        echo "Building Docker image..."
        docker build -t pyspark-test .
        
        echo "Running application (with timeout to prevent hanging)..."
        timeout 180s docker run --rm pyspark-test || {
          EXIT_CODE=$?
          if [ $EXIT_CODE -eq 124 ]; then
            echo "✅ Application ran successfully (timed out after 3 minutes as expected)"
            exit 0
          else
            echo "❌ Application failed with exit code $EXIT_CODE"
            exit $EXIT_CODE
          fi
        }
        
    - name: Test completion
      run: echo "✅ Quick test completed successfully!"